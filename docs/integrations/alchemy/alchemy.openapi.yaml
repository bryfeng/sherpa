openapi: 3.1.0
info:
  title: Sherpa Alchemy Integration
  version: 1.0.0
  description: |
    Consolidated OpenAPI description for the Alchemy-powered helper coroutines defined in
    `backend/app/providers/alchemy.py`. Includes the lightweight health probe, JSON-RPC methods for
    balances and token metadata, and the REST NFT ownership lookup so the spec can be imported into
    an agent tool builder.
servers:
  - url: https://eth-mainnet.g.alchemy.com/v2/{apiKey}
    description: Alchemy Ethereum Mainnet endpoint. Replace `{apiKey}` with your Alchemy key.
    variables:
      apiKey:
        default: YOUR_ALCHEMY_KEY
        description: Alchemy API key with Ethereum mainnet access.
tags:
  - name: Alchemy Health
    description: Readiness check against Alchemy's JSON-RPC endpoint.
  - name: Alchemy JSON-RPC
    description: JSON-RPC calls used by Sherpa for balances and metadata.
  - name: Alchemy NFTs
    description: REST helper to enumerate NFTs owned by a wallet.
paths:
  /:
    get:
      operationId: alchemyHealthCheck
      summary: Check Alchemy availability
      description: Issues a GET request with `method=eth_chainId` to confirm the endpoint responds.
      tags:
        - Alchemy Health
      parameters:
        - name: method
          in: query
          required: true
          schema:
            type: string
            const: eth_chainId
      responses:
        '200':
          description: Chain ID response from Alchemy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  jsonrpc:
                    type: string
                    example: "2.0"
                  id:
                    type: integer
                    example: 1
                  result:
                    type: string
                    description: Hex-encoded chain ID (e.g., `"0x1"` for Ethereum mainnet).
                    example: "0x1"
        default:
          description: Error response from Alchemy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    post:
      operationId: alchemyJsonRpc
      summary: Execute an Alchemy JSON-RPC method
      description: |
        Wrapper around the POST JSON-RPC interface. The request body must match one of the
        documented method shapes. Each example corresponds to a coroutine in
        `backend/app/providers/alchemy.py`.
      tags:
        - Alchemy JSON-RPC
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/EthGetBalanceRequest'
                - $ref: '#/components/schemas/AlchemyGetTokenBalancesRequest'
                - $ref: '#/components/schemas/AlchemyGetTokenBalanceForContractsRequest'
                - $ref: '#/components/schemas/AlchemyGetTokenMetadataRequest'
              description: JSON-RPC payload expected by Alchemy.
            examples:
              getNativeBalance:
                summary: get_native_balance
                value:
                  jsonrpc: "2.0"
                  method: eth_getBalance
                  params:
                    - 0x00000000219ab540356cBB839Cbe05303d7705Fa
                    - latest
                  id: 1
              getTokenBalances:
                summary: get_token_balances
                value:
                  jsonrpc: "2.0"
                  method: alchemy_getTokenBalances
                  params:
                    - 0x00000000219ab540356cBB839Cbe05303d7705Fa
                  id: 1
              getTokenBalanceForContract:
                summary: get_token_balance_for_contract
                value:
                  jsonrpc: "2.0"
                  method: alchemy_getTokenBalances
                  params:
                    - 0x00000000219ab540356cBB839Cbe05303d7705Fa
                    -
                      - 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48
                  id: 1
              getTokenMetadata:
                summary: get_token_metadata
                value:
                  jsonrpc: "2.0"
                  method: alchemy_getTokenMetadata
                  params:
                    - 0xdAC17F958D2ee523a2206206994597C13D831ec7
                  id: 1
      responses:
        '200':
          description: JSON-RPC success envelope containing the requested data.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EthGetBalanceResponse'
                  - $ref: '#/components/schemas/AlchemyTokenBalancesResponse'
                  - $ref: '#/components/schemas/AlchemyTokenMetadataResponse'
              examples:
                getNativeBalance:
                  value:
                    jsonrpc: "2.0"
                    id: 1
                    result: "0x16345785d8a0000"
                getTokenBalances:
                  value:
                    jsonrpc: "2.0"
                    id: 1
                    result:
                      address: 0x00000000219ab540356cBB839Cbe05303d7705Fa
                      tokenBalances:
                        - contractAddress: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48
                          tokenBalance: "0xde0b6b3a7640000"
                getTokenMetadata:
                  value:
                    jsonrpc: "2.0"
                    id: 1
                    result:
                      name: USD Coin
                      symbol: USDC
                      decimals: 6
                      logo: https://static.alchemyapi.io/images/token-logo/usdc.png
        default:
          description: Error response from Alchemy.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JsonRpcError'
              examples:
                invalidAddress:
                  value:
                    jsonrpc: "2.0"
                    id: 1
                    error:
                      code: -32602
                      message: 'invalid argument 0: hex string without 0x prefix'
  /getNFTs/:
    get:
      operationId: alchemyGetOwnedNfts
      summary: Fetch NFTs owned by an address for a specific contract
      description: Wrapper around Alchemy's `getNFTs` REST endpoint.
      tags:
        - Alchemy NFTs
      parameters:
        - name: owner
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/EthereumAddress'
          description: Wallet address to inspect.
        - name: withMetadata
          in: query
          required: false
          schema:
            type: string
            enum: ["true", "false"]
            default: "false"
          description: Whether to include full metadata in the response.
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Number of results to return per page.
        - name: pageKey
          in: query
          required: false
          schema:
            type: string
          description: Pagination token returned from a prior call.
        - name: contractAddresses[]
          in: query
          required: true
          schema:
            type: string
            pattern: ^0x[a-fA-F0-9]{40}$
          description: Contract address to filter on (repeat for multiple contracts).
      responses:
        '200':
          description: NFT ownership information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NftOwnershipResponse'
              examples:
                success:
                  value:
                    totalCount: 3
                    ownedNfts:
                      - contract:
                          address: 0xabcabcabcabcabcabcabcabcabcabcabcabcabc
                        id:
                          tokenId: "1"
                    pageKey: null
        default:
          description: Error response from Alchemy.
          content:
            application/json:
              schema:
                type: object
                required:
                  - error
                properties:
                  error:
                    type: string
                    description: Error message returned by Alchemy.
components:
  schemas:
    EthereumAddress:
      type: string
      pattern: ^0x[a-fA-F0-9]{40}$
      description: Checksummed Ethereum address.
    HexQuantity:
      type: string
      pattern: ^0x[0-9a-fA-F]+$
      description: Hex-encoded quantity as returned by Ethereum JSON-RPC.
    EthGetBalanceRequest:
      type: object
      required:
        - jsonrpc
        - method
        - params
        - id
      properties:
        jsonrpc:
          type: string
          const: "2.0"
        method:
          type: string
          const: eth_getBalance
        params:
          type: array
          prefixItems:
            - $ref: '#/components/schemas/EthereumAddress'
            - type: string
              description: Block tag such as `"latest"` or a hex block number.
          items: false
          minItems: 2
          maxItems: 2
        id:
          type: integer
          default: 1
    AlchemyGetTokenBalancesRequest:
      type: object
      required:
        - jsonrpc
        - method
        - params
        - id
      properties:
        jsonrpc:
          type: string
          const: "2.0"
        method:
          type: string
          const: alchemy_getTokenBalances
        params:
          type: array
          minItems: 1
          maxItems: 2
          prefixItems:
            - $ref: '#/components/schemas/EthereumAddress'
          items:
            $ref: '#/components/schemas/TokenBalanceFilter'
          description: |
            First element is the wallet address. Optionally include a filter object as the
            second element per the Alchemy docs.
        id:
          type: integer
          default: 1
    AlchemyGetTokenBalanceForContractsRequest:
      type: object
      required:
        - jsonrpc
        - method
        - params
        - id
      properties:
        jsonrpc:
          type: string
          const: "2.0"
        method:
          type: string
          const: alchemy_getTokenBalances
        params:
          type: array
          minItems: 2
          maxItems: 2
          prefixItems:
            - $ref: '#/components/schemas/EthereumAddress'
            - type: array
              minItems: 1
              items:
                $ref: '#/components/schemas/EthereumAddress'
          items: false
          description: Wallet address followed by a contract allowlist array.
        id:
          type: integer
          default: 1
    AlchemyGetTokenMetadataRequest:
      type: object
      required:
        - jsonrpc
        - method
        - params
        - id
      properties:
        jsonrpc:
          type: string
          const: "2.0"
        method:
          type: string
          const: alchemy_getTokenMetadata
        params:
          type: array
          minItems: 1
          maxItems: 1
          prefixItems:
            - $ref: '#/components/schemas/EthereumAddress'
          items: false
          description: Single-item array containing the token contract address.
        id:
          type: integer
          default: 1
    TokenBalanceFilter:
      type: object
      description: Optional filter object accepted by Alchemy's getTokenBalances method.
      additionalProperties: true
    TokenBalanceEntry:
      type: object
      required:
        - contractAddress
        - tokenBalance
      properties:
        contractAddress:
          $ref: '#/components/schemas/EthereumAddress'
        tokenBalance:
          type: string
          description: Hex-encoded balance in wei.
          example: "0xde0b6b3a7640000"
        error:
          type: string
          nullable: true
    TokenMetadata:
      type: object
      required:
        - name
        - symbol
        - decimals
      properties:
        name:
          type: string
        symbol:
          type: string
        decimals:
          type: integer
        logo:
          type: string
          format: uri
          nullable: true
        totalSupply:
          type: string
          nullable: true
          description: Hex quantity representing the token's total supply.
    JsonRpcSuccess:
      type: object
      required:
        - jsonrpc
        - id
        - result
      properties:
        jsonrpc:
          type: string
          example: "2.0"
        id:
          type: integer
          example: 1
        result:
          description: Method-specific response payload.
          nullable: true
    EthGetBalanceResponse:
      allOf:
        - $ref: '#/components/schemas/JsonRpcSuccess'
        - type: object
          properties:
            result:
              $ref: '#/components/schemas/HexQuantity'
    AlchemyTokenBalancesResponse:
      allOf:
        - $ref: '#/components/schemas/JsonRpcSuccess'
        - type: object
          properties:
            result:
              type: object
              required:
                - tokenBalances
              properties:
                address:
                  $ref: '#/components/schemas/EthereumAddress'
                tokenBalances:
                  type: array
                  items:
                    $ref: '#/components/schemas/TokenBalanceEntry'
    AlchemyTokenMetadataResponse:
      allOf:
        - $ref: '#/components/schemas/JsonRpcSuccess'
        - type: object
          properties:
            result:
              $ref: '#/components/schemas/TokenMetadata'
    JsonRpcError:
      type: object
      required:
        - jsonrpc
        - id
        - error
      properties:
        jsonrpc:
          type: string
          example: "2.0"
        id:
          type: integer
          example: 1
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: integer
              example: -32602
            message:
              type: string
            data:
              description: Additional error diagnostic info from Alchemy.
              nullable: true
    NftOwnershipResponse:
      type: object
      required:
        - totalCount
        - ownedNfts
      properties:
        totalCount:
          type: integer
          description: Total number of NFTs owned that match the filter.
        pageKey:
          type: string
          description: Cursor for fetching the next page of results.
          nullable: true
        ownedNfts:
          type: array
          description: NFT objects returned by Alchemy.
          items:
            type: object
            additionalProperties: true
